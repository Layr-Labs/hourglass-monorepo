version: '3.8'

services:
  executor:
#    image: public.ecr.aws/z6g0f8n7/eigenlayer-hourglass:v1.0.0-rc.3_56848e8
    build:
      context: ..
      dockerfile: ponos/Dockerfile
    networks:
      - hourglass-demo
    ports:
      - "127.0.0.1:9090:9090"
      - "127.0.0.1:9091:9091"
    command:
      - "executor"
      - "run"
      - "--config"
      - "/ponos-config/executor.yaml"
      - "--performer-network-name"
      - "custom-network"
    volumes:
      - .:/ponos-config
      - ../ponos/testKeys:/ponos-config/testKeys
      - /var/run/docker.sock:/var/run/docker.sock # required for DinD
  aggregator:
#    image: public.ecr.aws/z6g0f8n7/eigenlayer-hourglass:v1.0.0-rc.3_56848e8
    build:
      context: ..
      dockerfile: ponos/Dockerfile
    networks:
      - hourglass-demo
    ports:
      - "127.0.0.1:9000:9000"
      - "127.0.0.1:8081:8081"
    command:
      - "aggregator"
      - "run"
      - "--config"
      - "/ponos-config/aggregator-chain.yaml"
    volumes:
      - .:/ponos-config
      - ../ponos/testKeys:/ponos-config/testKeys
networks:
  hourglass-demo:
    driver: bridge
